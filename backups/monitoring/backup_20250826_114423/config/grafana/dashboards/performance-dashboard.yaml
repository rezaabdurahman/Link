# Performance Baseline Dashboard Configuration
# Comprehensive performance monitoring and baseline tracking

apiVersion: v1
kind: ConfigMap
metadata:
  name: performance-baseline-dashboard
  namespace: monitoring
  labels:
    app: grafana
    component: performance-monitoring
data:
  performance-dashboard.json: |
    {
      "dashboard": {
        "id": null,
        "title": "Performance Baseline Monitoring",
        "description": "Comprehensive performance baselines, SLO tracking, and trend analysis for Link services",
        "tags": ["performance", "slo", "baseline", "latency"],
        "style": "dark",
        "timezone": "browser",
        "refresh": "30s",
        "schemaVersion": 39,
        "version": 1,
        "time": {
          "from": "now-1h",
          "to": "now"
        },
        "timepicker": {
          "refresh_intervals": ["10s", "30s", "1m", "5m", "15m", "30m", "1h"],
          "time_options": ["5m", "15m", "1h", "6h", "12h", "24h", "2d", "7d"]
        },
        "templating": {
          "list": [
            {
              "name": "service",
              "type": "query",
              "query": "label_values(http_requests_total{namespace=\"link-services\"}, service)",
              "refresh": 1,
              "current": {
                "selected": true,
                "text": "All",
                "value": "$__all"
              },
              "options": [],
              "includeAll": true,
              "multi": true
            },
            {
              "name": "method",
              "type": "query",
              "query": "label_values(http_requests_total{namespace=\"link-services\", service=~\"$service\"}, method)",
              "refresh": 1,
              "current": {
                "selected": true,
                "text": "All",
                "value": "$__all"
              },
              "options": [],
              "includeAll": true,
              "multi": true
            }
          ]
        },
        "panels": [
          {
            "id": 1,
            "title": "ðŸŽ¯ SLO Compliance Status",
            "type": "stat",
            "targets": [
              {
                "expr": "slo:availability_7d",
                "legendFormat": "7-day Availability",
                "refId": "A"
              },
              {
                "expr": "slo:latency_compliance_7d",
                "legendFormat": "7-day Latency Compliance (<500ms)",
                "refId": "B"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "percent",
                "decimals": 2,
                "min": 0,
                "max": 100,
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": 0},
                    {"color": "yellow", "value": 95},
                    {"color": "green", "value": 99}
                  ]
                }
              },
              "overrides": [
                {
                  "matcher": {"id": "byName", "options": "7-day Availability"},
                  "properties": [
                    {"id": "thresholds", "value": {
                      "steps": [
                        {"color": "red", "value": 0},
                        {"color": "yellow", "value": 99.5},
                        {"color": "green", "value": 99.9}
                      ]
                    }}
                  ]
                }
              ]
            },
            "options": {
              "reduceOptions": {
                "values": false,
                "calcs": ["lastNotNull"],
                "fields": ""
              },
              "orientation": "horizontal",
              "textMode": "value_and_name",
              "colorMode": "background",
              "graphMode": "area"
            },
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0}
          },
          {
            "id": 2,
            "title": "âš¡ Real-time Performance Metrics",
            "type": "stat",
            "targets": [
              {
                "expr": "avg(perf:http_request_duration_95p{service=~\"$service\"})",
                "legendFormat": "P95 Latency",
                "refId": "A"
              },
              {
                "expr": "avg(perf:http_request_duration_99p{service=~\"$service\"})",
                "legendFormat": "P99 Latency",
                "refId": "B"
              },
              {
                "expr": "sum(perf:http_requests_per_second{service=~\"$service\"})",
                "legendFormat": "Requests/sec",
                "refId": "C"
              },
              {
                "expr": "avg(perf:http_error_rate{service=~\"$service\"})",
                "legendFormat": "Error Rate",
                "refId": "D"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "s",
                "decimals": 3,
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": 0},
                    {"color": "yellow", "value": 0.5},
                    {"color": "red", "value": 2.0}
                  ]
                }
              },
              "overrides": [
                {
                  "matcher": {"id": "byRegexp", "options": ".*Requests.*"},
                  "properties": [
                    {"id": "unit", "value": "reqps"},
                    {"id": "thresholds", "value": {
                      "steps": [
                        {"color": "red", "value": 0},
                        {"color": "yellow", "value": 10},
                        {"color": "green", "value": 50}
                      ]
                    }}
                  ]
                },
                {
                  "matcher": {"id": "byRegexp", "options": ".*Error.*"},
                  "properties": [
                    {"id": "unit", "value": "percent"},
                    {"id": "thresholds", "value": {
                      "steps": [
                        {"color": "green", "value": 0},
                        {"color": "yellow", "value": 1},
                        {"color": "red", "value": 5}
                      ]
                    }}
                  ]
                }
              ]
            },
            "options": {
              "reduceOptions": {
                "values": false,
                "calcs": ["lastNotNull"],
                "fields": ""
              },
              "orientation": "horizontal",
              "colorMode": "background"
            },
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0}
          },
          {
            "id": 3,
            "title": "ðŸ“ˆ Latency Trends by Service",
            "type": "timeseries",
            "targets": [
              {
                "expr": "perf:http_request_duration_95p{service=~\"$service\", method=~\"$method\"}",
                "legendFormat": "{{ service }}.{{ method }} P95",
                "refId": "A"
              },
              {
                "expr": "perf:http_request_duration_99p{service=~\"$service\", method=~\"$method\"}",
                "legendFormat": "{{ service }}.{{ method }} P99",
                "refId": "B"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "s",
                "min": 0,
                "custom": {
                  "drawStyle": "line",
                  "lineInterpolation": "smooth",
                  "lineWidth": 2,
                  "fillOpacity": 10,
                  "gradientMode": "opacity"
                }
              },
              "overrides": [
                {
                  "matcher": {"id": "byRegexp", "options": ".*P99.*"},
                  "properties": [
                    {"id": "custom.lineStyle", "value": {"dash": [5, 5]}}
                  ]
                }
              ]
            },
            "options": {
              "legend": {
                "displayMode": "table",
                "placement": "bottom",
                "calcs": ["lastNotNull", "max", "mean"]
              },
              "tooltip": {"mode": "multi"}
            },
            "gridPos": {"h": 8, "w": 24, "x": 0, "y": 8}
          },
          {
            "id": 4,
            "title": "ðŸš¦ Request Rate and Error Rate",
            "type": "timeseries",
            "targets": [
              {
                "expr": "perf:http_requests_per_second{service=~\"$service\", method=~\"$method\"}",
                "legendFormat": "{{ service }}.{{ method }} RPS",
                "refId": "A"
              },
              {
                "expr": "perf:http_error_rate{service=~\"$service\"}",
                "legendFormat": "{{ service }} Error Rate (%)",
                "refId": "B"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "reqps",
                "min": 0
              },
              "overrides": [
                {
                  "matcher": {"id": "byRegexp", "options": ".*Error.*"},
                  "properties": [
                    {"id": "unit", "value": "percent"},
                    {"id": "custom.axisPlacement", "value": "right"},
                    {"id": "color", "value": {"mode": "fixed", "fixedColor": "red"}},
                    {"id": "custom.fillOpacity", "value": 20}
                  ]
                }
              ]
            },
            "options": {
              "legend": {
                "displayMode": "table",
                "placement": "bottom",
                "calcs": ["lastNotNull", "max", "mean"]
              }
            },
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16}
          },
          {
            "id": 5,
            "title": "ðŸ’¾ Database Performance",
            "type": "timeseries",
            "targets": [
              {
                "expr": "perf:database_query_duration_95p",
                "legendFormat": "{{ datname }} Query P95 Latency",
                "refId": "A"
              },
              {
                "expr": "perf:database_connections_utilization",
                "legendFormat": "{{ datname }} Connection Utilization (%)",
                "refId": "B"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "s",
                "min": 0
              },
              "overrides": [
                {
                  "matcher": {"id": "byRegexp", "options": ".*Utilization.*"},
                  "properties": [
                    {"id": "unit", "value": "percent"},
                    {"id": "custom.axisPlacement", "value": "right"},
                    {"id": "max", "value": 100}
                  ]
                }
              ]
            },
            "options": {
              "legend": {
                "displayMode": "table",
                "placement": "bottom",
                "calcs": ["lastNotNull", "max", "mean"]
              }
            },
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 16}
          },
          {
            "id": 6,
            "title": "ðŸ”¥ Resource Utilization",
            "type": "timeseries",
            "targets": [
              {
                "expr": "perf:cpu_utilization_avg{service=~\"$service\"}",
                "legendFormat": "{{ service }} CPU %",
                "refId": "A"
              },
              {
                "expr": "perf:memory_utilization_avg{service=~\"$service\"}",
                "legendFormat": "{{ service }} Memory %",
                "refId": "B"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "percent",
                "min": 0,
                "max": 100,
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": 0},
                    {"color": "yellow", "value": 70},
                    {"color": "red", "value": 90}
                  ]
                }
              }
            },
            "options": {
              "legend": {
                "displayMode": "table",
                "placement": "bottom",
                "calcs": ["lastNotNull", "max", "mean"]
              }
            },
            "gridPos": {"h": 8, "w": 24, "x": 0, "y": 24}
          },
          {
            "id": 7,
            "title": "ðŸ“Š Performance Trend Analysis",
            "type": "stat",
            "targets": [
              {
                "expr": "perf:latency_trend_hourly{service=~\"$service\"}",
                "legendFormat": "{{ service }} Latency Change (24h)",
                "refId": "A"
              },
              {
                "expr": "perf:throughput_trend_hourly{service=~\"$service\"}",
                "legendFormat": "{{ service }} Throughput Change (24h)",
                "refId": "B"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "percent",
                "decimals": 1,
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": -100},
                    {"color": "yellow", "value": 10},
                    {"color": "red", "value": 25}
                  ]
                }
              },
              "overrides": [
                {
                  "matcher": {"id": "byRegexp", "options": ".*Throughput.*"},
                  "properties": [
                    {"id": "thresholds", "value": {
                      "steps": [
                        {"color": "red", "value": -100},
                        {"color": "yellow", "value": -10},
                        {"color": "green", "value": 5}
                      ]
                    }}
                  ]
                }
              ]
            },
            "options": {
              "reduceOptions": {
                "values": false,
                "calcs": ["lastNotNull"],
                "fields": ""
              },
              "orientation": "horizontal",
              "colorMode": "background"
            },
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 32}
          },
          {
            "id": 8,
            "title": "ðŸŽ¯ SLO Burn Rate Analysis",
            "type": "timeseries",
            "targets": [
              {
                "expr": "100 - slo:availability_7d",
                "legendFormat": "Availability Error Budget Used (%)",
                "refId": "A"
              },
              {
                "expr": "100 - slo:latency_compliance_7d",
                "legendFormat": "Latency Error Budget Used (%)",
                "refId": "B"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "percent",
                "min": 0,
                "max": 100,
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": 0},
                    {"color": "yellow", "value": 50},
                    {"color": "red", "value": 90}
                  ]
                }
              }
            },
            "options": {
              "legend": {
                "displayMode": "table",
                "placement": "bottom",
                "calcs": ["lastNotNull", "max", "mean"]
              }
            },
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 32}
          },
          {
            "id": 9,
            "title": "ðŸ“‹ Performance Baseline Summary",
            "type": "text",
            "gridPos": {"h": 12, "w": 24, "x": 0, "y": 40},
            "options": {
              "content": "## ðŸŽ¯ Performance Baseline Standards\\n\\n### Service Level Objectives (SLOs)\\n- **Availability**: 99.9% uptime (8.76 hours downtime/year maximum)\\n- **Latency**: 95% of requests served in <500ms\\n- **Error Rate**: <1% of requests result in 5xx errors\\n\\n### Performance Baselines\\n- **API Response Time**: P95 <500ms, P99 <2s\\n- **Database Queries**: P95 <250ms for standard operations\\n- **Resource Utilization**: CPU <80%, Memory <85%\\n- **Throughput**: Handle 1000+ requests/second during peak\\n\\n### Alert Thresholds\\n- **Critical**: P95 latency >2s, Error rate >5%, SLO violations\\n- **Warning**: P95 latency >1s, CPU >80%, Memory >85%\\n- **Info**: Performance trends degrading >25% over 24h\\n\\n### Monitoring Intervals\\n- **Real-time**: 30s metric collection\\n- **Alerting**: 1-2 minute evaluation windows\\n- **SLO**: 7-day rolling windows\\n- **Trends**: 24-hour comparisons\\n\\n### Performance Optimization Actions\\n1. **Immediate** (<5min): Alert on critical thresholds, automatic scaling\\n2. **Short-term** (5-30min): Investigate root causes, manual interventions\\n3. **Medium-term** (hours): Code optimizations, infrastructure changes\\n4. **Long-term** (days): Architecture reviews, capacity planning\\n\\n### Key Performance Indicators (KPIs)\\n- **User Experience**: <500ms page load, <2s API responses\\n- **System Health**: >99.9% availability, <1% error rate\\n- **Resource Efficiency**: <80% utilization, optimized costs\\n- **Scalability**: Linear performance scaling with load\",
              "mode": "markdown"
            }
          }
        ]
      }
    }