# 🔄 Reverse Proxy Access Guide

## How the Reverse Proxy Works

```
┌─────────────────┐    HTTPS/443    ┌──────────────────┐    HTTP     ┌─────────────┐
│   Your Browser  │◄─────────────────│  Nginx Proxy    │◄─────────────│  Grafana    │
│                 │                  │                  │             │   :3000     │
└─────────────────┘                  │                  │             └─────────────┘
                                     │  Authentication  │             
                                     │  TLS Termination │    HTTP     ┌─────────────┐
                                     │  Rate Limiting   │◄─────────────│ Prometheus  │
                                     │                  │             │   :9090     │
                                     └──────────────────┘             └─────────────┘
                                                                      
                                                                      ┌─────────────┐
                                                                      │   Jaeger    │
                                                                      │   :16686    │
                                                                      └─────────────┘
```

## 🔗 Access URLs

### **Single Entry Point:**
- **Base URL**: `https://monitoring.linkapp.local`
- **Port**: `443` (HTTPS only, HTTP redirects automatically)

### **Service Endpoints:**
- **Grafana**: `https://monitoring.linkapp.local/grafana/`
- **Prometheus**: `https://monitoring.linkapp.local/prometheus/`  
- **Jaeger**: `https://monitoring.linkapp.local/jaeger/`
- **AlertManager**: `https://monitoring.linkapp.local/alertmanager/`

## 🔐 Authentication Required

**All endpoints require HTTP Basic Authentication:**
- **Username**: `admin` (default, configurable)
- **Password**: Generated by setup script (stored in `monitoring/nginx/htpasswd`)

## 🚀 How to Access

### **Step 1: Add to hosts file**
```bash
# Add this line to your /etc/hosts file
echo "127.0.0.1 monitoring.linkapp.local" | sudo tee -a /etc/hosts
```

### **Step 2: Start the secure stack**
```bash
# Run the setup script first (generates credentials & certificates)
./monitoring/setup-secure-monitoring.sh

# Start the monitoring stack
docker-compose -f monitoring/docker-compose.monitoring.secure.yml up -d
```

### **Step 3: Access via browser**
1. Open: `https://monitoring.linkapp.local/grafana/`
2. You'll see SSL warning (self-signed cert) → Click "Advanced" → "Proceed"
3. Browser will prompt for credentials → Enter username/password from setup
4. You're now in Grafana dashboard!

## 🛡️ Security Features

### **What the Proxy Does:**
1. **TLS Termination** - Handles all SSL/HTTPS encryption
2. **Authentication Gate** - Single point of access control
3. **Rate Limiting** - Prevents abuse and DoS attacks
4. **Path Routing** - Routes `/grafana/` → Grafana, `/prometheus/` → Prometheus
5. **Security Headers** - Adds HSTS, CSP, XSS protection
6. **Request Filtering** - Blocks malicious patterns and hidden files

### **What You Get:**
- ✅ **Single secure endpoint** instead of multiple exposed ports
- ✅ **Centralized authentication** for all monitoring tools
- ✅ **Encrypted traffic** (HTTPS only)
- ✅ **Protection against attacks** (rate limiting, security headers)
- ✅ **Clean URLs** with path-based routing

## 🔑 Credential Management

### **View Generated Credentials:**
```bash
# See the admin password
cat monitoring/secrets/grafana_admin_password.txt

# Check Basic Auth credentials
cat monitoring/nginx/htpasswd
```

### **Change Credentials:**
```bash
# Generate new Basic Auth password
htpasswd -c monitoring/nginx/htpasswd admin

# Restart proxy to apply changes
docker-compose -f monitoring/docker-compose.monitoring.secure.yml restart monitoring-proxy
```

## 🌍 Before vs After

### **❌ BEFORE (Insecure):**
```bash
# Multiple exposed ports, no auth
http://localhost:3000      # Grafana
http://localhost:9090      # Prometheus  
http://localhost:16686     # Jaeger
```

### **✅ AFTER (Secure):**
```bash
# Single authenticated HTTPS endpoint
https://monitoring.linkapp.local/grafana/      # Grafana
https://monitoring.linkapp.local/prometheus/   # Prometheus
https://monitoring.linkapp.local/jaeger/       # Jaeger
```

## 🔧 Troubleshooting

### **Can't Access?**
1. Check if proxy is running: `docker ps | grep monitoring-proxy`
2. Check hosts file: `cat /etc/hosts | grep monitoring`
3. Test certificate: `openssl s_client -connect monitoring.linkapp.local:443`

### **SSL Certificate Issues?**
```bash
# Regenerate certificates
cd monitoring/ssl
openssl req -x509 -newkey rsa:4096 -keyout monitoring.key -out monitoring.crt -days 365 -nodes

# Restart proxy
docker-compose -f monitoring/docker-compose.monitoring.secure.yml restart monitoring-proxy
```

### **Authentication Problems?**
```bash
# Check htpasswd file exists
ls -la monitoring/nginx/htpasswd

# Recreate credentials  
htpasswd -c monitoring/nginx/htpasswd admin
```

## 🎯 Production Notes

For production deployment:

1. **Replace self-signed certificates** with proper CA-signed certificates
2. **Use real domain name** instead of `.local`
3. **Configure DNS** to point to your server
4. **Set up log monitoring** for the proxy access logs
5. **Consider adding OAuth/SAML** instead of Basic Auth

---

**The reverse proxy acts as a security gateway - all monitoring tools are now protected behind a single, authenticated, encrypted endpoint!**
